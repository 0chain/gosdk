name: "0Chain System Tests"

on:
  workflow_dispatch:
    inputs:
      system_tests_branch:
        description: 'system_tests branch containing the tests you wish to run'
        default: 'master'
        required: true
      zbox_cli_branch:
        description: 'zbox CLI branch which the tests will use'
        default: 'staging'
        required: true
      zwallet_cli_branch:
        description: 'zwallet CLI branch which the tests will use'
        default: 'staging'
        required: true
      miner_sharder_branch:
        description: 'miner/sharder branch to deploy'
        default: 'staging'
        required: true
      blobber_validator_branch:
        description: 'blobber/validator branch to deploy'
        default: 'staging'
        required: true
      s3_migration_cli_branch:
          required: false
          description: 'S3 Migration CLI (branch or commit SHA) which the tests will use'
          default: 'staging'
      zbox_branch:
        description: '0box branch to deploy'
        default: 'staging'
        required: true
      test_file_filter:
        description: 'Comma separated list of test files to run (eg. zwalletcli_register_wallet_test.go, zwalletcli_send_and_balance_test.go). If supplied, the PR will NOT be notified of the test result'
        default: ''
        required: false
      run_smoke_tests:
        description: 'Run subset of system tests (smoke tests) for faster feedback (NOT FOR PRS POINTED TO STAGING)'
        default: 'false'
        required: false
      skip_tests:
        description: '(LAST RESORT ONLY) Skip system tests. This will allow a PR to merge without requiring a green test run.  *By using you certify that the code being merged is not causing system tests to fail*'
        default: 'FALSE'
        required: true
jobs:
  system-tests:
    uses: 0chain/actions/.github/workflows/manual_system_tests.yml@master
    with:
      gosdk_branch: ${{ github.ref_name }}
      system_tests_branch: ${{ github.event.inputs.system_tests_branch }}
      miner_branch: ${{ github.event.inputs.miner_sharder_branch }}
      sharder_branch: ${{ github.event.inputs.miner_sharder_branch }}
      zbox_cli_branch: ${{ github.event.inputs.zbox_cli_branch }}
      zwallet_cli_branch: ${{ github.event.inputs.zwallet_cli_branch }}
      blobber_branch: ${{ github.event.inputs.blobber_validator_branch }}
      validator_branch: ${{ github.event.inputs.blobber_validator_branch }}
      zbox_branch: ${{ github.event.inputs.zbox_branch }}
      s3_migration_cli_branch: ${{ github.event.inputs.s3_migration_cli_branch }}
      zdns_branch: staging
      run_smoke_tests: ${{ github.event.inputs.run_smoke_tests }}
      test_file_filter: ${{ github.event.inputs.test_file_filter }}
      skip_tests: ${{ github.event.inputs.skip_tests }}
      run_frontend_tests: true
      
    secrets:
      SVC_ACCOUNT_SECRET: ${{ secrets.SVC_ACCOUNT_SECRET }}
      DEV1KC: ${{ secrets.DEV1KC }}
      DEV2KC: ${{ secrets.DEV2KC }}
      DEV3KC: ${{ secrets.DEV3KC }}
      DEV4KC: ${{ secrets.DEV4KC }}
      DEV5KC: ${{ secrets.DEV5KC }}
      DEV6KC: ${{ secrets.DEV6KC }}
      DEV7KC: ${{ secrets.DEV7KC }}
      DEV8KC: ${{ secrets.DEV8KC }}
      DEV9KC: ${{ secrets.DEV9KC }}
      SUBGRAPH_API_URL: ${{ secrets.SUBGRAPH_API_URL }}
      TENDERLY_FORK_ID: ${{ secrets.TENDERLY_FORK_ID }}
      DEVOPS_CHANNEL_WEBHOOK_URL: ${{ secrets.DEVOPS_CHANNEL_WEBHOOK_URL }}
      GRAPHNODE_SC: ${{ secrets.GRAPHNODE_SC }}
      GRAPHNODE_NETWORK: ${{ secrets.GRAPHNODE_NETWORK }}
      GRAPHNODE_ETHEREUM_NODE_URL: https://rpc.tenderly.co/fork/${{ secrets.TENDERLY_FORK_ID }}
      S3_ACCESS_KEY: ${{ secrets.S3_ACCESS_KEY }}
      S3_SECRET_KEY: ${{ secrets.S3_SECRET_KEY }}

